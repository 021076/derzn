{% extends 'drevo/base.html' %}
{% load static %}

{% block cssfiles %}
<link rel="stylesheet" href="{% static '/drevo/css/questions_user.css' %}">
{% endblock %}

{% block content %}
    <h2>Знание: {{ question.knowledge }}</h2>
    <hr>
    <h3>Вопрос: {{ question }}</h3>
    <hr>
    <h4>Ответы:</h4>
    <form action="answers_from_users" method="post">
    {% csrf_token %}
    {% for answer in answers %}
    <div class="answers">
        {% if answer.answer %}
        <div>{{ answer.answer }}</div>
        {% else%}
        <div></div>
        {% endif%}

        {% if answer.answer_file %}
        <div><a href="{{ answer.answer_file.url }}">Файл</a></div>
        {% else%}
        <div></div>
        {% endif%}
        
        <div>
            <select name="{{ answer.id }}" class="acceptance">
                {% if answer.inspector and answer.accepted == True %}
                <option selected value="accepted">Принято</option>
                <option value="not_accepted">Не принято</option>
                <option value="not_checked">-------</option>
                {% elif answer.inspector and answer.accepted == False %}
                <option value="accepted">Принято</option>
                <option selected value="not_accepted">Не принято</option>
                <option value="not_checked">-------</option>
                {% else%}
                <option value="accepted">Принято</option>
                <option value="not_accepted">Не принято</option>
                <option selected value="not_checked">-------</option>
                {% endif %}
            </select>  
            <select name="reason{{answer.id}}" id="{{ answer.id }}" style="visibility: hidden;">
                <option value="">--Выберите причину--</option>
                <option value="less">Без объяснений</option>
                {% for reason in reasons %}
                <option value="{{ reason.id }}">{{ reason }}</option>
                {% endfor%}
            </select>        
        </div>
        {% if answer.refuse_reason %}
        <div>Причина: {{ answer.refuse_reason}}</div>
        {% endif %}
    </div>
    {% endfor %}
    <input class="accepted" type="submit">
    </form>
{% endblock %}

{% block jsfiles %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.addEventListener('click', function(e) {
            if (e.target.className === 'acceptance' && e.target.value === 'not_accepted') {
                document.getElementById(e.target.name).style.visibility = 'visible'
                console.log(e.target.name)
                
            }
            else if (e.target.className === 'acceptance' && e.target.value !== 'not_accepted') {
                document.getElementById(e.target.name).style.visibility = 'hidden'
                console.log(e.target.name)
                
            }
        })
    })
</script>
{% endblock %}