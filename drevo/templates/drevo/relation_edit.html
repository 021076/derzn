{% extends 'drevo/base.html' %}
{% load mptt_tags %}
{% load filter %}
{% load static %}

{% block title %}Редактирование знания для таблицы{% endblock %}

{% block cssfiles %}
    <link rel="stylesheet" href="{% static '/drevo/css/drevo.css' %}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block jsfiles %}
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
{% endblock %}

{% block content %}
    <h1>{{ title }} </h1>
    <form class="form-horizontal" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.media }}
        {{ form.as_p }}
        <input type="submit" class="btn btn-primary" value="Сохранить">
    </form>

    <script>
        const rowSelect = window.opener.document.getElementById('id_row');
        const columnSelect = window.opener.document.getElementById('id_column');
        const deleteRow = window.opener.document.getElementById('delete_row');
        const deleteColumn = window.opener.document.getElementById('delete_column');
        const selectZnanie = document.getElementById("id_table")
        const isNew = {{ new|yesno:"true,false" }};
        if (isNew) {
            const changedZnanieName = '{{ changed_znanie_name }}';
            const changedZnanieId = '{{ changed_znanie_id }}';
            const relation = '{{ relation }}';
            if (relation === 'row') {
                const optionToChange = [...rowSelect.options].find(option => option.value === changedZnanieId);
                if (optionToChange) {
                  optionToChange.text = changedZnanieName;
                }
            }
            else {
                const optionToChange = [...columnSelect.options].find(option => option.value === changedZnanieId);
                if (optionToChange) {
                  optionToChange.text = changedZnanieName;
                }
            }
            window.close()
        }
    </script>

{% endblock %}
